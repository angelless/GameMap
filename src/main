package gamemap;

import cn.nukkit.Player;
import cn.nukkit.event.Listener;
import cn.nukkit.level.Position;
import cn.nukkit.plugin.PluginBase;
import javax.imageio.ImageIO;

import java.awt.Color;
import java.awt.Frame;
import java.awt.Graphics;
import java.awt.Graphics2D;
import java.awt.image.BufferedImage;
import java.io.File;
import java.io.IOException;

public class main extends PluginBase implements Listener {

	@Override
	public void onEnable() {
		
		this.getServer().getPluginManager().registerEvents(this, this);
		this.getDataFolder().mkdirs();

		BufferedImage image;
		try {
			image = new BufferedImage(200, 200, BufferedImage.TYPE_INT_RGB);
			Graphics2D graphics = image.createGraphics();
			Position spawn = this.getServer().getDefaultLevel().getSafeSpawn();
			for (int x = 0; x < 200; x++) {
				for (int y = 0; y < 200; y++) {
					graphics.setColor(this.getServer().getDefaultLevel().getMapColorAt(spawn.getFloorX() - 100 + x,
							spawn.getFloorZ() - 100 + y));
					graphics.fillRect(x, y, x, y);
				}
			}
			for (Player player : this.getServer().getOnlinePlayers().values()) {
				int x = player.getPosition().getFloorX();
				int y = player.getPosition().getFloorZ();
				Position spawn1 = this.getServer().getDefaultLevel().getSafeSpawn();

				if (x <= spawn1.getFloorX() + 100 && x >= spawn1.getFloorX() - 100
						|| y <= spawn1.getFloorZ() + 100 && y >= spawn1.getFloorZ() - 100) {
					this.getLogger().alert("12123");
					graphics.setColor(Color.white);
					graphics.fillRect( (spawn.getFloorX()-x)+100, (spawn.getFloorZ()-y)+100, (spawn.getFloorX()-x)+100, (spawn.getFloorZ()-y)+100);
					graphics.setColor(Color.PINK);
					graphics.drawString(player.getName(), (spawn.getFloorX()-x)+100, (spawn.getFloorZ()-y)+100);
					
				}
			}
			try {
				File file = new File(this.getDataFolder() + "/world.jpeg");
				ImageIO.write(image, "jpeg", file);
			} catch (IOException e) {
				// TODO 자동 생성된 catch 블록
				e.printStackTrace();
			}
		} finally {
		}
	}

}
